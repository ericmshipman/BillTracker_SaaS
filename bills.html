<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="Scripts/supabase-common.js"></script>
    <title>Bills</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-...your-integrity-key..."
        crossorigin="anonymous"
    />
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        defer
    ></script>
</head>
<body>
    <div class="container my-4">
        <h4 class="mb-3">My Bills</h4>
        <ul class="list-group rounded-3 shadow-sm" id="billList"></ul>
        <button class="btn btn-primary w-100 mt-4" onclick="startAddBill()">+ Add Bill</button>
        <style>
            .list-group-item {
                border: none;
                border-bottom: 1px solid #eee;
                }
        </style>
    </div>
      <script>
        async function renderBills() {
        const bills = await getBills();
        const list = document.getElementById("billList");
        list.innerHTML = "";

        bills.forEach(bill => {
            const li = document.createElement("li");
            li.className = "list-group-item py-3";

            li.innerHTML = `
            <div class="d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <div class="fw-bold fs-5">${bill.name}</div>
                    <div class="text-muted small">Every ${bill.occurs_every} ${bill.occurs_every_unit}(s)</div>
                </div>
                <div class="text-end text-nowrap">
                    <span class="fw-bold text-success">$${bill.amount.toFixed(2)}</span>
                </div>
                </div>
                <div class="mt-2 d-flex justify-content-end gap-2">
                <button class="btn btn-sm btn-outline-secondary" onclick="editBill(${bill.id})">Edit</button>
                <button class="btn btn-sm btn-outline-danger" onclick="delBill(${bill.id})">Delete</button>
                </div>
            </div>
            `;


                list.appendChild(li);
            });
        }

        async function delBill(id) {
        if (confirm("Are you sure you want to delete this bill?")) {
            await deleteBill(id);
            await renderBills();
        }}

        async function editBill(id){
            window.location.href = "addBill.html?id=" + id
        }

        async function startAddBill(){
            window.location.href = "addBill.html";
        }

renderBills();  
      </script>
</body>
</html>